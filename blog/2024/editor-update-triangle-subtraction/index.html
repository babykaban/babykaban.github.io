<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="kL2NjtvChhJi-npbtl_4yNZj2UKrGmStbdgOgqRS8lU"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Triangle Boolean Subtraction | BabyKaban </title> <meta name="author" content="Paul I. Solodrai"> <meta name="description" content="Editor update"> <meta name="keywords" content="blog, spellweaver saga, spellweaver, solodrai, babykaban, game engine"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.css" integrity="sha256-uRX+PiRTR4ysKFRCykT8HLuRCub26LgXJZym3Yeom1c=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/site_logo.jpeg?012e7a2c5e17fa21c2b2e608cf0cdb38"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://babykaban.github.io/blog/2024/editor-update-triangle-subtraction/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> BabyKaban </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">GitHub Repositories </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Triangle Boolean Subtraction</h1> <p class="post-meta"> Created in August 18, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/category/blog"> <i class="fa-solid fa-tag fa-sm"></i> blog</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="introduction">Introduction</h2> <p>In game development, navigation meshes are useful for defining walkable areas where AI characters can move. These meshes are made up of interconnected polygons that represent navigable surfaces, allowing for efficient pathfinding. My game uses navigation meshes for AI and player movement control. The need to handle dynamic obstacles was the main reason I developed this algorithm. The algorithm subtracts two triangles by removing the overlapping part from one of the triangles.</p> <p>Here is an example:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/subtract_example_0-480.webp 480w,/assets/img/subtract_example_0-800.webp 800w,/assets/img/subtract_example_0-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/subtract_example_0.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/subtract_example_1-480.webp 480w,/assets/img/subtract_example_1-800.webp 800w,/assets/img/subtract_example_1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/subtract_example_1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> On the left are triangles before the subtraction and on the right after. </div> <p>To create an obstacle on a navigation mesh, we need to mark the walkable area as unwalkable, which literally involves making a hole in the navigation polygon.</p> <p>Initially, I researched existing algorithms that could perform this task, but I couldn’t find any ready-to-use solutions. However, I did find a detailed documentation that outlines how to construct such an algorithm, which you can check out <a href="https://www.pnnl.gov/main/publications/external/technical_reports/PNNL-SA-97135.pdf" rel="external nofollow noopener" target="_blank">here</a>.</p> <p>Using this as a foundation, I started building the algorithm. After some tests on various polygon types and the decision to use single precision floating point, the algorithm began to show issues — sometimes crashing, other times producing incorrect results.</p> <p>To simplify the task, I decided to perform the subtraction on triangles, reducing the possible cases to 20. From here, I began developing the algorithm based on <code class="language-plaintext highlighter-rouge">JE Wilson's</code> guidelines.</p> <p>For those who just want to see or use the code without reading through the whole explanation, here’s the <a href="https://github.com/babykaban/Triangle-Boolean-Subtraction-Algorithm" rel="external nofollow noopener" target="_blank">GitHub link</a>.</p> <h2 id="implementation">Implementation</h2> <p>The image below will appear throughout the implementation steps to illustrate how it changes.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/subtract_0-480.webp 480w,/assets/img/subtract_0-800.webp 800w,/assets/img/subtract_0-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/subtract_0.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Blue triangle is `Subject` and red is `Subtractor`. </div> <p>The first step is to check if two triangles overlap, excluding edges and vertices. For this, I used the <a href="https://dyn4j.org/2010/01/sat/" rel="external nofollow noopener" target="_blank">Separating Axis Theorem (SAT)</a>. Then, I corrected the triangles’ orientation. The <code class="language-plaintext highlighter-rouge">JE Wilson</code> suggests calculating an offset based on the polygons’ orientation, but for simplicity, I made the algorithm work only on clockwise triangles. If necessary, the triangles are reoriented by swapping the second and last vertices. The orientation changes or calculationg an offset are needed for the later processing when from bunch of tables the resulting polygons will be constructed.</p> <p>Next, I checked for triangle collinearity to eliminate cases with sliver triangles. If all checks pass, we create a polygon to hold points from the Subject triangle, allowing for the insertion of additional points if needed. The overlap polygon is then calculated using the <a href="https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm" rel="external nofollow noopener" target="_blank">Sutherland-Hodgman algorithm for clipping</a>.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/subtract_1-480.webp 480w,/assets/img/subtract_1-800.webp 800w,/assets/img/subtract_1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/subtract_1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Now the yellow polygon becomes the `Subtractor`. </div> <p>Once the <code class="language-plaintext highlighter-rouge">Subtractor</code> is created, it should be cleaned up by removing duplicate points and merging those that are very close together. We then check if the <code class="language-plaintext highlighter-rouge">Subtractor's</code> area is significant enough and if the difference between the <code class="language-plaintext highlighter-rouge">Subtractor's</code> area and the <code class="language-plaintext highlighter-rouge">Subject's</code> area is sufficient to proceed.</p> <p>We then check if any vertex of the <code class="language-plaintext highlighter-rouge">Subtractor</code> lies on the first vertex of the <code class="language-plaintext highlighter-rouge">Subject</code>. If so, the points of the Subject are rotated clockwise in the array to avoid stacking too many points in one place and ensure the algorithm functions correctly. The first vertices of both the <code class="language-plaintext highlighter-rouge">Subject</code> and <code class="language-plaintext highlighter-rouge">Subtractor</code> are duplicated to their respective ends.</p> <p>Next, we identify all points of the <code class="language-plaintext highlighter-rouge">Subject</code> that lie outside the <code class="language-plaintext highlighter-rouge">Subtractor</code>. This is straightforward, as points not found in the <code class="language-plaintext highlighter-rouge">Subtractor</code> are considered outside. We then determine which points of the <code class="language-plaintext highlighter-rouge">Subtractor</code> are on the <code class="language-plaintext highlighter-rouge">Subject's</code> edges and which edges they belong to. The result is a sorted array of points and a table detailing how many points are on each <code class="language-plaintext highlighter-rouge">Subject</code> edge. If no intersection points are found, we record the <code class="language-plaintext highlighter-rouge">Subtractor</code> as a hole in the <code class="language-plaintext highlighter-rouge">Subject</code> and exit the function.</p> <p>Here are two function that perform operation above</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">internal</span> <span class="n">points_between</span> <span class="o">*</span>
<span class="nf">GetIntersectionPointsF32</span><span class="p">(</span><span class="n">polygon2</span> <span class="o">*</span><span class="n">A</span><span class="p">,</span> <span class="n">polygon2</span> <span class="o">*</span><span class="n">B</span><span class="p">,</span> <span class="n">v2</span> <span class="o">*</span><span class="n">OutputPoints</span><span class="p">,</span> <span class="n">s32</span> <span class="o">*</span><span class="n">OutputCount</span><span class="p">,</span> <span class="n">memory_arena</span> <span class="o">*</span><span class="n">Arena</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">points_between</span> <span class="o">*</span><span class="n">Result</span> <span class="o">=</span> <span class="n">PushArray</span><span class="p">(</span><span class="n">Arena</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">points_between</span><span class="p">);</span>

    <span class="n">temporary_memory</span> <span class="n">TempMem</span> <span class="o">=</span> <span class="n">BeginTemporaryMemory</span><span class="p">(</span><span class="n">Arena</span><span class="p">);</span>
    <span class="n">s32</span> <span class="n">TempCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">v2</span> <span class="o">*</span><span class="n">Temp</span> <span class="o">=</span> <span class="n">PushArray</span><span class="p">(</span><span class="n">TempMem</span><span class="p">.</span><span class="n">Arena</span><span class="p">,</span> <span class="n">SUBTRACTION_MAX_POINTS_PER_POLYGON</span><span class="p">,</span> <span class="n">v2</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="n">s32</span> <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">I</span> <span class="o">&lt;</span> <span class="n">A</span><span class="o">-&gt;</span><span class="n">VertexCount</span><span class="p">;</span>
        <span class="o">++</span><span class="n">I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">v2</span> <span class="n">Prv</span> <span class="o">=</span> <span class="n">A</span><span class="o">-&gt;</span><span class="n">Vertices</span><span class="p">[</span><span class="n">I</span><span class="p">];</span>
        <span class="n">v2</span> <span class="n">Cur</span> <span class="o">=</span> <span class="n">A</span><span class="o">-&gt;</span><span class="n">Vertices</span><span class="p">[(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">A</span><span class="o">-&gt;</span><span class="n">VertexCount</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">PointsAreEqualF32</span><span class="p">(</span><span class="n">Prv</span><span class="p">,</span> <span class="n">Cur</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">IntersectLineSegmentF32</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">Prv</span><span class="p">,</span> <span class="n">Cur</span><span class="p">,</span> <span class="n">Temp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TempCount</span><span class="p">,</span> <span class="n">Arena</span><span class="p">);</span>
            <span class="n">s32</span> <span class="n">AddedCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="n">s32</span> <span class="n">J</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">J</span> <span class="o">&lt;</span> <span class="n">TempCount</span><span class="p">;</span>
                <span class="o">++</span><span class="n">J</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">IsNewPointF32</span><span class="p">(</span><span class="n">OutputPoints</span><span class="p">,</span> <span class="o">*</span><span class="n">OutputCount</span><span class="p">,</span> <span class="n">Temp</span><span class="p">[</span><span class="n">J</span><span class="p">]))</span>
                <span class="p">{</span>
                    <span class="n">OutputPoints</span><span class="p">[(</span><span class="o">*</span><span class="n">OutputCount</span><span class="p">)</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Temp</span><span class="p">[</span><span class="n">J</span><span class="p">];</span>
                    <span class="o">++</span><span class="n">AddedCount</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">Result</span><span class="p">[</span><span class="n">I</span><span class="p">].</span><span class="n">Count</span> <span class="o">=</span> <span class="n">AddedCount</span><span class="p">;</span>
            <span class="n">Result</span><span class="p">[</span><span class="n">I</span><span class="p">].</span><span class="n">I0</span> <span class="o">=</span> <span class="n">I</span><span class="p">;</span>
            <span class="n">Result</span><span class="p">[</span><span class="n">I</span><span class="p">].</span><span class="n">I1</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">A</span><span class="o">-&gt;</span><span class="n">VertexCount</span><span class="p">;</span>
            
            <span class="n">TempCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">EndTemporaryMemory</span><span class="p">(</span><span class="n">TempMem</span><span class="p">);</span>

    <span class="k">return</span><span class="p">(</span><span class="n">Result</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">internal</span> <span class="n">b32</span>
<span class="nf">IntersectLineSegmentF32</span><span class="p">(</span><span class="n">polygon2</span> <span class="o">*</span><span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="n">p1</span><span class="p">,</span> <span class="n">v2</span> <span class="n">p2</span><span class="p">,</span> <span class="n">v2</span> <span class="o">*</span><span class="n">Points</span><span class="p">,</span> <span class="n">s32</span> <span class="o">*</span><span class="n">PointCount</span><span class="p">,</span> <span class="n">memory_arena</span> <span class="o">*</span><span class="n">Arena</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">temporary_memory</span> <span class="n">TempMem</span> <span class="o">=</span> <span class="n">BeginTemporaryMemory</span><span class="p">(</span><span class="n">Arena</span><span class="p">);</span>

    <span class="n">b32</span> <span class="n">Intersect</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">s32</span> <span class="n">TempPointCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">v2</span> <span class="o">*</span><span class="n">TempPoints</span> <span class="o">=</span> <span class="n">PushArray</span><span class="p">(</span><span class="n">TempMem</span><span class="p">.</span><span class="n">Arena</span><span class="p">,</span> <span class="n">SUBTRACTION_MAX_POINTS_PER_POLYGON</span><span class="p">,</span> <span class="n">v2</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="n">s32</span> <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">I</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">VertexCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="o">++</span><span class="n">I</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">s32</span> <span class="n">J</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">VertexCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">v2</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">A</span><span class="o">-&gt;</span><span class="n">Vertices</span><span class="p">[</span><span class="n">I</span><span class="p">];</span>
        <span class="n">v2</span> <span class="n">p4</span> <span class="o">=</span> <span class="n">A</span><span class="o">-&gt;</span><span class="n">Vertices</span><span class="p">[</span><span class="n">J</span><span class="p">];</span>

        <span class="n">b32</span> <span class="n">Ends</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">DistanceToSegmentF32</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">SUBTRACT_DISTANCE_TO_EPSILON_F32</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TempPoints</span><span class="p">[</span><span class="n">TempPointCount</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">p3</span><span class="p">;</span>
            <span class="n">Intersect</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">Ends</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">DistanceToSegmentF32</span><span class="p">(</span><span class="n">p4</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">SUBTRACT_DISTANCE_TO_EPSILON_F32</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TempPoints</span><span class="p">[</span><span class="n">TempPointCount</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">p4</span><span class="p">;</span>
            <span class="n">Intersect</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">Ends</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">TempPointCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ZeroArray</span><span class="p">((</span><span class="o">*</span><span class="n">PointCount</span><span class="p">)</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">v2</span><span class="p">),</span> <span class="n">Points</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">TempPointCount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Points</span><span class="p">[(</span><span class="o">*</span><span class="n">PointCount</span><span class="p">)</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">TempPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">s32</span> <span class="n">SortCount</span> <span class="o">=</span> <span class="n">TempPointCount</span><span class="p">;</span>
            <span class="n">sort_entry</span> <span class="o">*</span><span class="n">SortArray</span> <span class="o">=</span> <span class="n">PushArray</span><span class="p">(</span><span class="n">TempMem</span><span class="p">.</span><span class="n">Arena</span><span class="p">,</span> <span class="n">TempPointCount</span><span class="p">,</span> <span class="n">sort_entry</span><span class="p">);</span>
            <span class="n">sort_entry</span> <span class="o">*</span><span class="n">Temp</span> <span class="o">=</span> <span class="n">PushArray</span><span class="p">(</span><span class="n">TempMem</span><span class="p">.</span><span class="n">Arena</span><span class="p">,</span> <span class="n">TempPointCount</span><span class="p">,</span> <span class="n">sort_entry</span><span class="p">);</span>
            <span class="k">for</span><span class="p">(</span><span class="n">s32</span> <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">I</span> <span class="o">&lt;</span> <span class="n">TempPointCount</span><span class="p">;</span>
                <span class="o">++</span><span class="n">I</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">sort_entry</span> <span class="o">*</span><span class="n">Entry</span> <span class="o">=</span> <span class="n">SortArray</span> <span class="o">+</span> <span class="n">I</span><span class="p">;</span>
                <span class="n">Entry</span><span class="o">-&gt;</span><span class="n">Index</span> <span class="o">=</span> <span class="n">I</span><span class="p">;</span>
                <span class="n">Entry</span><span class="o">-&gt;</span><span class="n">SortKey</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">TempPoints</span><span class="p">[</span><span class="n">I</span><span class="p">]);</span>
            <span class="p">}</span>

            <span class="n">RadixSort</span><span class="p">(</span><span class="n">SortCount</span><span class="p">,</span> <span class="n">SortArray</span><span class="p">,</span> <span class="n">Temp</span><span class="p">);</span>

            <span class="n">v2</span> <span class="n">Last</span> <span class="o">=</span> <span class="n">TempPoints</span><span class="p">[</span><span class="n">SortArray</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Index</span><span class="p">];</span>
            <span class="n">Points</span><span class="p">[(</span><span class="o">*</span><span class="n">PointCount</span><span class="p">)</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Last</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="n">s32</span> <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">I</span> <span class="o">&lt;</span> <span class="n">TempPointCount</span><span class="p">;</span>
                <span class="o">++</span><span class="n">I</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">v2</span> <span class="n">This</span> <span class="o">=</span> <span class="n">TempPoints</span><span class="p">[</span><span class="n">SortArray</span><span class="p">[</span><span class="n">I</span><span class="p">].</span><span class="n">Index</span><span class="p">];</span>
                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">PointsAreEqualF32</span><span class="p">(</span><span class="n">This</span><span class="p">,</span> <span class="n">Last</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">Points</span><span class="p">[(</span><span class="o">*</span><span class="n">PointCount</span><span class="p">)</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">This</span><span class="p">;</span>
                    <span class="n">Last</span> <span class="o">=</span> <span class="n">This</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">EndTemporaryMemory</span><span class="p">(</span><span class="n">TempMem</span><span class="p">);</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">Intersect</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>For the example illustrated above, the table will look like this:</p> <table> <thead> <tr> <th style="text-align: left">Edge Start Index</th> <th style="text-align: left">Edge End Index</th> <th style="text-align: left">Point Count</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">0</td> <td style="text-align: left">1</td> <td style="text-align: left">0</td> </tr> <tr> <td style="text-align: left">1</td> <td style="text-align: left">2</td> <td style="text-align: left">2</td> </tr> <tr> <td style="text-align: left">2</td> <td style="text-align: left">3</td> <td style="text-align: left">2</td> </tr> </tbody> </table> <p>If points are found, they are inserted into the Subject in the places described by the resulting table. We then need to build more tables, one for the Subject and one for the Subtractor. These tables contain information about each vertex of each polygon—whether the point is outside, if it is a crossing point, which point it crosses, a processed flag, and the point itself.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/subtract_2-480.webp 480w,/assets/img/subtract_2-800.webp 800w,/assets/img/subtract_2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/subtract_2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Updated image with inserted points and their coordinates. </div> <p>As a result, we have two tables that look like this:</p> <p><em>Subject Vertex Info</em></p> <table> <thead> <tr> <th style="text-align: center">Vertex Index</th> <th style="text-align: center">Point (x, y)</th> <th style="text-align: center">Outside Flag</th> <th style="text-align: center">Cross</th> <th style="text-align: center">Processed Flag</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">0</td> <td style="text-align: center">(-8, 12)</td> <td style="text-align: center">true</td> <td style="text-align: center">-1</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">1</td> <td style="text-align: center">(8, 18)</td> <td style="text-align: center">true</td> <td style="text-align: center">-1</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">2</td> <td style="text-align: center">(10, 11)</td> <td style="text-align: center">false</td> <td style="text-align: center">1</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">3</td> <td style="text-align: center">(11.1, 7.1)</td> <td style="text-align: center">false</td> <td style="text-align: center">2</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">4</td> <td style="text-align: center">(16, -10)</td> <td style="text-align: center">true</td> <td style="text-align: center">-1</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">5</td> <td style="text-align: center">(4.5, 0.5)</td> <td style="text-align: center">false</td> <td style="text-align: center">3</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">6</td> <td style="text-align: center">(-0.9, 5.5)</td> <td style="text-align: center">false</td> <td style="text-align: center">4</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">7</td> <td style="text-align: center">(-8, 12)</td> <td style="text-align: center">true</td> <td style="text-align: center">-1</td> <td style="text-align: center">false</td> </tr> </tbody> </table> <p><em>Subtractor Vertex Info</em></p> <table> <thead> <tr> <th style="text-align: center">Vertex Index</th> <th style="text-align: center">Point (x, y)</th> <th style="text-align: center">Outside Flag</th> <th style="text-align: center">Cross</th> <th style="text-align: center">Processed Flag</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">0</td> <td style="text-align: center">(-0.9, 5.5)</td> <td style="text-align: center">false</td> <td style="text-align: center">6</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">1</td> <td style="text-align: center">(10, 11)</td> <td style="text-align: center">false</td> <td style="text-align: center">2</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">2</td> <td style="text-align: center">(11.1, 7.1)</td> <td style="text-align: center">false</td> <td style="text-align: center">3</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">3</td> <td style="text-align: center">(4.5, 0.5)</td> <td style="text-align: center">false</td> <td style="text-align: center">5</td> <td style="text-align: center">false</td> </tr> <tr> <td style="text-align: center">4</td> <td style="text-align: center">(-0.9, 5.5)</td> <td style="text-align: center">false</td> <td style="text-align: center">6</td> <td style="text-align: center">false</td> </tr> </tbody> </table> <p>With these tables built, the function that creates the resulting polygons is run, and the process is finished. The function that constructs the polygons is similar to the one described in the documentation, with a few modifications, so feel free to read through the implementation steps in section 2.5 <a href="https://www.pnnl.gov/main/publications/external/technical_reports/PNNL-SA-97135.pdf" rel="external nofollow noopener" target="_blank">here</a>.</p> <p>The result of this fucntion you can see below:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/subtract_3-480.webp 480w,/assets/img/subtract_3-800.webp 800w,/assets/img/subtract_3-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/subtract_3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Resulting polygons A and B. </div> <h2 id="why-single-precision-floating-point">Why Single Precision Floating Point?</h2> <p>The initial implementation used double precision floating point, which has its advantages—fewer checks are needed, and results are more accurate for very small triangles. However, because this function will be used in a game, speed is crucial. Comparing the worst cases of both implementations, the single precision version is 2-2.5 times faster.</p> <p>In benchmarks, the double-precision implementation consumes around 250,000 CPU cycles per frame in debug mode, while the single-precision version uses about 100,000 cycles. Additionally, the double precision requires twice as much memory as the single precision.</p> <h2 id="what-is-the-caveat">What is the Caveat?</h2> <p>The expected issue with the single precision implementation was incorrect handling of cases where <code class="language-plaintext highlighter-rouge">Subtractor</code> vertices or edges are very close to <code class="language-plaintext highlighter-rouge">Subject</code> vertices or edges. I addressed this by using <code class="language-plaintext highlighter-rouge">EPSILON</code> and merging points that are very close together, though finding the correct <code class="language-plaintext highlighter-rouge">EPSILON</code> value took some time.</p> <h2 id="conclusion">Conclusion</h2> <p>The algorithm now works efficiently and quickly, though there’s always room for improvement. I tested the algorithm by generating overlapping triangles across all 20 cases, testing 2,048 cases per frame, which translates to about 7.4 billion cases per hour. After several hours of testing, no cases crashed, which I believe confirms the algorithm’s reliability.</p> <p>That’s it for this post. If you want to implement your own algorithm, the <a href="https://www.pnnl.gov/main/publications/external/technical_reports/PNNL-SA-97135.pdf" rel="external nofollow noopener" target="_blank">documentation</a> I used is quite helpful—much of the code comes directly from there. Otherwise, you can check out my <a href="https://github.com/babykaban/Triangle-Boolean-Subtraction-Algorithm" rel="external nofollow noopener" target="_blank">repo</a> with the source code of the implementation described.</p> <p>Привіт</p> <p>Take care, <strong><a href="https://github.com/babykaban" rel="external nofollow noopener" target="_blank">BabyKaban</a></strong></p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/editor-update-triangulation/">Advancing Navigation Meshes and Triangulation</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/editor-update-map-mode/">Expanding the World Map Editor Mode</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/editor-update-sswm-format/">Introducing Spellweaver Saga World Map (SSWM)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/welcome-to-the-spellweaver-saga-blog/">Welcome to the Spellweaver Saga Blog!</a> </li> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 Paul I. Solodrai. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: September 27, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.js" integrity="sha256-4rppopQE9POKfukn2kEvhJ9Um25Cf6+IDVkARD0xh78=" crossorigin="anonymous"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-89DCRVDVVQ"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-89DCRVDVVQ");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"About",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"Blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-projects",title:"Projects",description:"This is a collaction of projects that I&#39;ve been working on or worked on.",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-github-repositories",title:"GitHub Repositories",description:"",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"post-advancing-navigation-meshes-and-triangulation",title:"Advancing Navigation Meshes and Triangulation",description:"Editor update",section:"Posts",handler:()=>{window.location.href="/blog/2024/editor-update-triangulation/"}},{id:"post-triangle-boolean-subtraction",title:"Triangle Boolean Subtraction",description:"Editor update",section:"Posts",handler:()=>{window.location.href="/blog/2024/editor-update-triangle-subtraction/"}},{id:"post-expanding-the-world-map-editor-mode",title:"Expanding the World Map Editor Mode",description:"Editor update",section:"Posts",handler:()=>{window.location.href="/blog/2024/editor-update-map-mode/"}},{id:"post-introducing-spellweaver-saga-world-map-sswm",title:"Introducing Spellweaver Saga World Map (SSWM)",description:"Editor update",section:"Posts",handler:()=>{window.location.href="/blog/2024/editor-update-sswm-format/"}},{id:"post-welcome-to-the-spellweaver-saga-blog",title:"Welcome to the Spellweaver Saga Blog!",description:"Very First Blog Post",section:"Posts",handler:()=>{window.location.href="/blog/2024/welcome-to-the-spellweaver-saga-blog/"}},{id:"news-very-first-blog-post-is-now-up-blog-2024-welcome-to-the-spellweaver-saga-blog",title:"[Very first blog post is now up!!!](/blog/2024/welcome-to-the-spellweaver-saga-blog/)",description:"",section:"News"},{id:"projects-spellweaver-saga-retrieving-the-legendary-relic",title:"Spellweaver Saga Retrieving The Legendary Relic",description:"This is the first video game that babykaban has been working on.",section:"Projects",handler:()=>{window.location.href="/projects/spellweaver_saga/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%70%61%75%6C%39%32%32%31%39@%70%72%6F%74%6F%6E.%6D%65","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/babykaban","_blank")}},{id:"socials-x",title:"X",description:"Twitter",section:"Socials",handler:()=>{window.open("https://twitter.com/BabyKaban","_blank")}},{id:"socials-youtube",title:"YouTube",section:"Socials",handler:()=>{window.open("https://youtube.com/@BabyKaban","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>